<?php $this->layout->nav();?>
        <div class="container">
            <div class="blog-header">
                <h1 class="blog-title">
                </h1>
                <p class="lead blog-description">
                </p>
            </div>
            <div class="row">
                <!-- 文本内容 -->
                <?php foreach ($article as $item):;?>
                <div class="col-sm-8 blog-main">
                    <div class="jumbotron blog-post">
                        <h2 class="blog-post-title" style="text-align: center">
                            <?php echo $item['title'];?>
                        </h2>
                        <ul class="row list-inline">
                            <li class="col-sm-2  col-sx-2">
                                <span class="glyphicon glyphicon-user">
                                </span>
                                朴义發
                            </li>
                            <li class="col-sm-4 col-sx-4">
                                <span class="glyphicon glyphicon-th-list">
                                </span>
                                <a href="<?php echo site_url('index/home/category/').$item['category_id'];?>" target="_blank">
                                    <?php echo $item['cateName'];?>
                                </a>
                            </li>
                            <li class="col-sm-3 col-sx-2">
                                <span class="glyphicon glyphicon-tag">
                                </span>
                                <a href="<?php echo site_url('index/home/tag/').$item['tag_id'];?>" target="_blank">
                                    <?php echo $item['tagName'];?>
                                </a>
                            </li>
                            <li class="col-sm-3 col-sx-4">
                                <span class="glyphicon glyphicon-time">
                                </span>
                                <?php echo $item['date'];?>
                            </li>
                        </ul>
                        <hr/>
                         <div class="content">
                             <?php echo $item['content'];?>
                         </div>
                    </div>
                    <?php endforeach; ?>
                    <!-- 文本内容结束 -->

                    <!-- 评论 -->
                    <div class="jumbotron blog-post">
                        <ul class="media p-media">
                            <li class="media">
                                <div class="media-left" href="#">
                                    <img class="media-object" src="http://127.0.0.1/uploads/avatar/6.jpg"
                                    alt="通用的占位符图像">
                                </div>
                                <div class="media-body">
                                    <div class="box-textarea">
                                        <div class="box-content" contenteditable="true" onfocus="del_hint(this)">
                                            请先登录后发表评论
                                        </div>
                                        <ul class="emote-submit">
                                            <li class="emote col-sm-10 col-xs-10">
                                                <img class="fa fa-smile-o" onclick="getEmote(this)" src="<?php echo site_url().'/source/index/img/emote.png';?>">
                                            </li>
                                            <li class="submit-button col-sm-2 col-xs-2">
                                                <input type="button" class="btn btn-info pull-right" value="评 论" aid="<?php echo $item['id'] ;?>" pid="0" onclick="comment(this)">
                                            </li>
                                        </ul>
                                        <div class="emote-img ">
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                        <hr>
                        <ul class="media p-media">
                            <li class="common-left col-sm-10 col-xs-10">
                                最新评论
                            </li>
                            <li class="common-right col-sm-2 col-xs-2">
                                共0评论
                            </li>
                        </ul>
                        <hr>
                        <ul class="media-list">
                            <li class="media">
                                <div class="media-left">
                                    <img class="media-object" src="http://www.runoob.com/wp-content/uploads/2014/06/64.jpg"
                                    alt="通用的占位符图像">
                                </div>
                                <div class="media-body">
                                    <p class="p-comment">
                                        文本 ：随机
                                    </p>
                                    <span class="p-time">
                                        2017-08-17 18:03:54
                                    </span>
                                    <span class="p-reply" onclick="reply(this)">
                                        回复
                                    </span>
                                    </p>
                                    <div class="media">
                                        <div class="media-left" href="#">
                                            <img class="media-object" src="http://www.runoob.com/wp-content/uploads/2014/06/64.jpg"
                                            alt="通用的占位符图像">
                                        </div>
                                        <div class="media-body">
                                            <p class="p-comment">
                                                文本 ：随机
                                            </p>
                                            <span class="p-time">
                                                2017-08-17 18:03:54
                                            </span>
                                            <span class="p-reply" onclick="reply(this)">
                                                回复
                                            </span>
                                            </p>
                                        </div>
                                    </div>
                                    <!-- 嵌套的媒体对象 -->
                                    <div class="media">
                                        <div class="media-left" href="#">
                                            <img class="media-object" src="http://www.runoob.com/wp-content/uploads/2014/06/64.jpg"
                                            alt="通用的占位符图像">
                                        </div>
                                        <div class="media-body">
                                            <p class="p-comment">
                                                文本 ：随机
                                            </p>
                                            <span class="p-time">
                                                2017-08-17 18:03:54
                                            </span>
                                            <span class="p-reply" onclick="reply(this)">
                                                回复
                                            </span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="media">
                                <div class="media-left" href="#">
                                    <img class="media-object" src="http://www.runoob.com/wp-content/uploads/2014/06/64.jpg"
                                    alt="通用的占位符图像">
                                </div>
                                <div class="media-body">
                                    <p class="p-comment">
                                        文本 ：随机
                                    </p>
                                    <span class="p-time">
                                        2017-08-17 18:03:54
                                    </span>
                                    <span class="p-reply" onclick="reply(this)">
                                        回复
                                    </span>
                                    </p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <!-- 评论结束 -->
                    <!-- /.blog-article -->
                </div>
                <!-- /.blog-main -->

            <script>

            // 发布评论
            function comment(obj){
            alert(234);
                //$.get(checkLogin, function(data) {
                    //if(data==1){
                        var contents = $(obj).parents('.box-textarea').eq(0).find('.box-content').html();
                        if(contents != '' && contents != '请先登录后发表评论'){
                            var aid=$(obj).attr('aid'),
                                pid=$(obj).attr('pid'),
                                postData={
                                    "aid":aid,
                                    "pid":pid,
                                    "contents":contents
                                };
                            // 显示loading
                            //layer.load(1);
                            // ajax评论
                            var url = '<?php echo site_url("index/comments/add") ;?>';
                            $.post(url, postData, function(data) {
                                var dataObj = JSON.parse(data);
                                var newpid = dataObj.cid; // 评论pid
                                var uid = dataObj.uid; // 用户id
                                var nickname = dataObj.nickname; // 用户
                                var headpath = "<?php echo site_url().'/uploads/avatar/';?>";
                                var headimg = headpath+uid+".jpg";
                                var replyName = $(obj).attr('username');
                                var create_time = dataObj.create_time;
                                // 获取当前时间
                                var nickName=$('#b-login-word .b-nickname').text();
                                if(pid==0){
                                    // pid为0表示新增评论
                                    var str = '<li class="media"><div class="media-left" href="#"><img class="media-object" src="'+headimg+'" alt="通用的占位符图像"></div><div class="media-body"><p class="p-comment">'+nickname+' ：'+contents+'</p><span class="p-time">'+create_time+'</span><span class="p-reply" onclick="reply(this)" pid="'+newpid+'" aid="'+aid+'" href="javascript:;">回复</span></p></div></li>';
                                    $('.media-list').prepend(str);
                                }else{
                                    // pid不为0表示是回复评论
                                    //var str='<div class="row b-user b-child"><div class="col-xs-2 col-sm-1 col-md-1 col-lg-1 b-pic-col"><img title="'+titleName+'" alt="'+titleName+'" src="'+headImg+'" class="b-user-pic"></div><ul class="col-xs-10 col-sm-11 col-md-11 col-lg-11 b-content-col"><li class="b-content"><span class="b-reply-name">'+nickName+'</span><span class="b-reply">回复</span><span class="b-user-name">'+replyName+'</span>：'+content+'</li><li class="b-date">'+date+' <a onclick="reply(this)" pid="'+newPid+'" aid="'+aid+'" username="'+replyName+'" href="javascript:;">回复</a></li><li class="b-clear-float"></li></ul></div>';
                                    var str = '<div class="media-left" href="#"><img class="media-object" src="'+headimg+'" alt="通用的占位符图像"></div><div class="media-body"><p class="p-comment">'+nickname+' ：'+contents+'</p><span class="p-time">'+create_time+'</span><span class="p-reply" onclick="reply(this)" pid="'+newpid+'" aid="'+aid+'" href="javascript:;">回复</span></p></div>';
                                    $(obj).parents('.media-body').eq(0).append(str);
                                    $(obj).parents('.box-textarea').eq(0).remove();
                                }
                                //$(obj).parents('.b-box-textarea').eq(0).find('.b-box-content').html('');
                                // 关闭loading
                                //layer.closeAll();
                            });
                        }
                    //}else{
                    //    $('#b-modal-login').modal('show');
                    //}
                //});
            }

            </script>
<?php $this->layout->right();?>
<?php $this->layout->footer();?>
